<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Support Schedule</title>
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 24px;
    }

    h1 {
      margin-top: 0;
      font-size: 28px;
      text-align: center;
    }

    .now-card {
      border-radius: 12px;
      padding: 16px 20px;
      margin-bottom: 24px;
      background: #020617;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .status-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 12px;
      flex-wrap: wrap;
    }

    .status-pill {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .status-open {
      background: rgba(34, 197, 94, 0.16);
      color: #4ade80;
    }

    .status-closed {
      background: rgba(248, 113, 113, 0.16);
      color: #fb7185;
    }

    .dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: currentColor;
    }

    .now-title {
      font-size: 18px;
      font-weight: 600;
    }

    .now-subtitle {
      font-size: 14px;
      color: #9ca3af;
    }

    .now-people {
      margin-top: 8px;
      font-size: 15px;
    }

    .now-people span {
      font-weight: 600;
      color: #e5e7eb;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      border-radius: 12px;
      overflow: hidden;
      background: #020617;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
    }

    thead {
      background: #020617;
    }

    th, td {
      padding: 12px 16px;
      font-size: 14px;
      text-align: left;
    }

    th {
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-size: 12px;
      color: #9ca3af;
      border-bottom: 1px solid #1f2937;
    }

    tbody tr:nth-child(even) {
      background: #020617;
    }

    tbody tr:nth-child(odd) {
      background: #020617;
    }

    tbody tr + tr td {
      border-top: 1px solid #111827;
    }

    .today-row {
      background: #111827;
    }

    .today-badge {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(96, 165, 250, 0.15);
      color: #60a5fa;
      margin-left: 8px;
    }

    .footer {
      margin-top: 16px;
      font-size: 12px;
      color: #6b7280;
      text-align: center;
    }

    @media (max-width: 640px) {
      .container {
        padding: 16px;
      }
      h1 {
        font-size: 22px;
      }
      th, td {
        padding: 8px 10px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Omni Arena & Omni One Support Schedule (DEC 1st - DEC 8th)</h1>

    <div class="container">
        <!-- HEADER WITH VIRTUIX LOGO -->
        <div class="header">
            <img
            src="omniarena_logo_color2.png"
            alt="Virtuix logo"
            style="max-width: 140px; height: auto; display: block; margin: 0 auto 16px;"
          >
          
          
        </div>
    
    <div class="now-card">
      <div class="status-row">
        <div>
          <div id="status-pill" class="status-pill">
            <div class="dot"></div>
            <span id="status-text">Checking...</span>
          </div>
          <div class="now-title" id="now-title">Now</div>
          <div class="now-subtitle" id="now-subtitle"></div>
        </div>
        <div class="now-subtitle" id="now-time"></div>
      </div>
      <div class="now-people" id="now-people"></div>
    </div>

    <table>
  <thead>
    <tr>
      <th>Day</th>
      <th>Business hours</th>
      <th>On duty</th>
      <th>Notes</th>   <!-- NUEVA COLUMNA -->
    </tr>
  </thead>
  <tbody id="schedule-body">
    <!-- Filled by JS -->
  </tbody>
</table>

    <div class="footer">
      Schedule for Martin &amp; Jonathan • Autoupdates based on current day and time
    </div>
  </div>

  <script>
  // ====== CONFIG: URL of your published Google Sheet CSV ======
  const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT_P-MDtJ5_22Dftrk9JC9gQmaWzIM_YLBVEJ7n_hyU4bm4PSgzUbWOdIB-e184eJpaL2SUqB92tumS/pub?output=csv";

  // These will be filled dynamically from the sheet
  let schedule = {};
  let businessHours = {};
  let notesByDay = {};

 // For Date.getDay() -> key (0 = Sunday, 6 = Saturday)
const keyByIndex = [
  "sunday", "monday", "tuesday", "wednesday",
  "thursday", "friday", "saturday"
];

// Label per key
const dayLabel = {
  monday: "Monday",
  tuesday: "Tuesday",
  wednesday: "Wednesday",
  thursday: "Thursday",
  friday: "Friday",
  saturday: "Saturday",
  sunday: "Sunday"
};

// Order in which we want to DISPLAY rows (Mon -> Sun)
const displayOrder = [
  "monday",
  "tuesday",
  "wednesday",
  "thursday",
  "friday",
  "saturday",
  "sunday"
];

 async function loadScheduleFromSheet() {
  const res = await fetch(SHEET_CSV_URL);
  const csv = await res.text();

  const lines = csv.trim().split(/\r?\n/);
  if (lines.length < 2) return;

  const sched = {};
  const hours = {};

  // Detect delimiter: ; (common in ES locales) or ,
  const delimiter = lines[0].includes(";") ? ";" : ",";

  // We ignore the header row (lines[0]) and use fixed column positions
  // We ignore the header row (lines[0]) and use fixed column positions
  for (let i = 1; i < lines.length; i++) {
    if (!lines[i].trim()) continue;

    const cols = lines[i].split(delimiter);
    // Col order: 0=day_key, 1=open, 2=close, 3=on_duty, 4=notes
    const dayKeyRaw  = (cols[0] || "").trim().toLowerCase();
    const openRaw    = (cols[1] || "").trim();
    const closeRaw   = (cols[2] || "").trim();
    const onDutyRaw  = (cols[3] || "").trim();
    const notesRaw   = (cols[4] || "").trim();  // NUEVO

    if (!dayKeyRaw) continue;

    const dayKey = dayKeyRaw;
    const open = openRaw || "10:00";
    const close = closeRaw || "18:00";

    const people = onDutyRaw
      ? onDutyRaw.split(/[;|]/).map(p => p.trim()).filter(Boolean)
      : [];

    sched[dayKey] = people;
    hours[dayKey] = { open, close };
    notesByDay[dayKey] = notesRaw;   // NUEVO
  }

  schedule = sched;
  businessHours = hours;
  // notesByDay ya está actualizado

  console.log("Loaded schedule:", schedule);
  console.log("Loaded businessHours:", businessHours);
}


  function isOpenNow(dayKey, now) {
    const hours = businessHours[dayKey];
    if (!hours) return false;

    const [openH, openM] = hours.open.split(":").map(Number);
    const [closeH, closeM] = hours.close.split(":").map(Number);

    const openMinutes = openH * 60 + openM;
    const closeMinutes = closeH * 60 + closeM;
    const currentMinutes = now.getHours() * 60 + now.getMinutes();

    return currentMinutes >= openMinutes && currentMinutes < closeMinutes;
  }

  function formatHours(dayKey) {
    const hours = businessHours[dayKey];
    if (!hours) return "Closed";

    const to12h = (timeStr) => {
      const [hStr, mStr] = timeStr.split(":");
      let h = Number(hStr);
      const m = mStr;
      const suffix = h >= 12 ? "PM" : "AM";
      if (h === 0) h = 12;
      else if (h > 12) h -= 12;
      return `${h}:${m}${suffix}`;
    };

    return `${to12h(hours.open)} – ${to12h(hours.close)}`;
  }

 function initSchedule() {
  const tbody = document.getElementById("schedule-body");
  tbody.innerHTML = "";

  const now = new Date();
  const todayIndex = now.getDay();        // 0–6
  const todayKey = keyByIndex[todayIndex]; // "monday", "tuesday", etc.

  // Render in custom order (Monday -> Sunday)
  for (const key of displayOrder) {
    const dayName = dayLabel[key];
    const row = document.createElement("tr");

    if (key === todayKey) {
      row.classList.add("today-row");
    }

       const people = schedule[key] && schedule[key].length
      ? schedule[key].join(", ")
      : "—";

    const note = notesByDay[key] && notesByDay[key].length
      ? notesByDay[key]
      : "—";

    const tdDay = document.createElement("td");
    tdDay.textContent = dayName;
    // ...

    const tdHours = document.createElement("td");
    tdHours.textContent = formatHours(key);

    const tdPeople = document.createElement("td");
    tdPeople.textContent = people;

    const tdNotes = document.createElement("td");  // NUEVO
    tdNotes.textContent = note;                   // NUEVO

    row.appendChild(tdDay);
    row.appendChild(tdHours);
    row.appendChild(tdPeople);
    row.appendChild(tdNotes);                     // NUEVO

    tbody.appendChild(row);
  }

  updateNowCard();
  setInterval(updateNowCard, 60000);
}


  function updateNowCard() {
    const now = new Date();
    const todayIndex = now.getDay();
    const todayKey = keyByIndex[todayIndex];

    const statusPill = document.getElementById("status-pill");
    const statusText = document.getElementById("status-text");
    const nowTitle = document.getElementById("now-title");
    const nowSubtitle = document.getElementById("now-subtitle");
    const nowPeople = document.getElementById("now-people");
    const nowTime = document.getElementById("now-time");

    const open = isOpenNow(todayKey, now);

    statusPill.classList.remove("status-open", "status-closed");

    if (open) {
      statusPill.classList.add("status-open");
      statusText.textContent = "Open";
    } else {
      statusPill.classList.add("status-closed");
      statusText.textContent = "Closed";
    }

    nowTitle.textContent = dayLabel[todayKey];
    nowSubtitle.textContent = formatHours(todayKey);

    const peopleToday = schedule[todayKey] || [];
    if (open && peopleToday.length) {
      nowPeople.innerHTML = `On duty now: <span>${peopleToday.join(", ")}</span>`;
    } else if (!open) {
      nowPeople.textContent = "Outside business hours.";
    } else {
      nowPeople.textContent = "No one assigned today.";
    }

    const pad = (n) => n.toString().padStart(2, "0");
    const hours = pad(now.getHours());
    const minutes = pad(now.getMinutes());
    nowTime.textContent = `Current time: ${hours}:${minutes}`;
  }

  document.addEventListener("DOMContentLoaded", async () => {
    try {
      await loadScheduleFromSheet();
    } catch (err) {
      console.error("Error loading schedule from sheet:", err);
    }
    initSchedule();
  });
</script>

  
  
</body>
</html>
